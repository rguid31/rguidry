<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat with Ryan's Digital Assistant</title>

    <!-- 1. Link to your EXISTING stylesheet -->
    <link rel="stylesheet" href="style.css">

    <!-- 2. Link to Tailwind CSS (required for the chatbot's layout) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 3. Link to Google Fonts (to match your site) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- 4. Copy the chatbot's SPECIFIC styles -->
    <style>
        /* These are the custom styles from the chatbot code */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F9FAFB;
        }
        .chat-container {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05), 0 6px 6px rgba(0, 0, 0, 0.07);
            transition: all 0.3s ease;
        }
        .messages-area::-webkit-scrollbar { width: 6px; }
        .messages-area::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .messages-area::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }
        .messages-area::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
        .message { max-width: 75%; padding: 10px 16px; border-radius: 18px; line-height: 1.5; word-wrap: break-word; }
        .message.user { background-color: #2563EB; color: white; border-bottom-right-radius: 4px; }
        .message.bot { background-color: #E5E7EB; color: #1F2937; border-bottom-left-radius: 4px; }
        .typing-indicator { display: flex; align-items: center; padding: 10px 0; }
        .typing-indicator span { height: 8px; width: 8px; margin: 0 2px; background-color: #9ca3af; border-radius: 50%; display: inline-block; animation: bounce 1.4s infinite ease-in-out both; }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
        .send-btn { background-color: #2563EB; transition: background-color 0.3s ease; }
        .send-btn:hover { background-color: #1D4ED8; }
        .send-btn:disabled { background-color: #93C5FD; cursor: not-allowed; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen bg-gray-50">

    <div id="chatbot" class="chat-container w-full max-w-2xl h-[90vh] max-h-[700px] bg-white rounded-2xl flex flex-col mx-4">
        
        <!-- Chat Header -->
        <div class="p-4 border-b border-gray-200 flex items-center space-x-4 flex-shrink-0">
            <img src="https://placehold.co/48x48/2563EB/FFFFFF?text=RG" alt="Avatar" class="w-12 h-12 rounded-full">
            <div>
                <h1 class="text-lg font-semibold text-gray-800">Ryan's Digital Assistant</h1>
                <p class="text-sm text-green-500 flex items-center">
                    <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                    Online
                </p>
            </div>
        </div>

        <!-- Messages Area -->
        <div id="messages-area" class="messages-area flex-1 p-6 space-y-4 overflow-y-auto">
            <!-- Initial bot message -->
            <div class="flex justify-start">
                <div class="message bot">
                    Hey there! I'm the digital assistant for Ryan Guidry. I can answer questions about his skills, projects, and experience. What's on your mind?
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="p-4 bg-white border-t border-gray-200 flex-shrink-0">
            <form id="chat-form" class="flex items-center space-x-3">
                <input 
                    type="text" 
                    id="user-input" 
                    placeholder="Ask about my projects, skills, etc..."
                    class="flex-1 w-full px-4 py-2 bg-gray-100 border border-transparent rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                    autocomplete="off">
                <button 
                    type="submit" 
                    id="send-btn"
                    class="send-btn text-white rounded-full p-3 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>
                </button>
            </form>
        </div>
    </div>

    <script>
        // --- DOM Element References ---
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const messagesArea = document.getElementById('messages-area');
        const sendButton = document.getElementById('send-btn');

        // --- KNOWLEDGE BASE ---
        // This is the "brain" of your chatbot.
        // Fill this with information about yourself, your skills, projects, and answers to common questions.
        // The more detail you provide, the smarter your chatbot will be.
        const KNOWLEDGE_BASE = `
            About Ryan Guidry:
            - A 29-year-old self-taught web developer and programmer from Baton Rouge, Louisiana.
            - Holds a Google Data Analytics Professional Certificate.
            - Passionate about building clean, efficient, and user-friendly web applications.
            - Currently working on his portfolio website: https://www.rguidry.dev.

            Skills:
            - Frontend: HTML, CSS, JavaScript.
            - Data Analytics: SQL, R, Tableau, Spreadsheets.
            - Strong problem-solving and analytical skills.
            - Quick learner, always exploring new technologies.

            Projects:
            - Personal Portfolio (rguidry.dev): A showcase of his work and skills, built from scratch.
            - (Add more projects here with brief descriptions and links if available)

            Contact & Professional Goals:
            - Looking for opportunities in web development or data analytics where he can contribute and grow.
            - The best way to contact him is via the form on his website.
            - He is open to freelance projects and full-time roles.
        `;

        // --- CHAT HISTORY ---
        // We store the conversation history to give the AI context.
        let chatHistory = [];

        // --- EVENT LISTENER FOR FORM SUBMISSION ---
        chatForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const userMessage = userInput.value.trim();

            if (userMessage) {
                // 1. Display the user's message immediately
                addMessage(userMessage, 'user');
                userInput.value = '';
                
                // 2. Disable input and show typing indicator
                toggleInput(false);
                showTypingIndicator();

                // 3. Get the bot's response
                try {
                    const botResponse = await getBotResponse(userMessage);
                    // 4. Remove typing indicator and display bot's response
                    hideTypingIndicator();
                    addMessage(botResponse, 'bot');
                } catch (error) {
                    console.error("Error getting bot response:", error);
                    hideTypingIndicator();
                    addMessage("Oops! Something went wrong. Please try again.", 'bot');
                } finally {
                    // 5. Re-enable the input form
                    toggleInput(true);
                }
            }
        });

        // --- HELPER FUNCTIONS ---

        /**
         * Adds a message to the chat window.
         * @param {string} text - The message text.
         * @param {string} sender - 'user' or 'bot'.
         */
        function addMessage(text, sender) {
            const messageWrapper = document.createElement('div');
            messageWrapper.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
            
            const messageElement = document.createElement('div');
            messageElement.className = `message ${sender}`;
            messageElement.textContent = text;
            
            messageWrapper.appendChild(messageElement);
            messagesArea.appendChild(messageWrapper);

            // Scroll to the latest message
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        /**
         * Shows the "Bot is typing..." indicator.
         */
        function showTypingIndicator() {
            const indicator = document.createElement('div');
            indicator.id = 'typing-indicator';
            indicator.className = 'typing-indicator';
            indicator.innerHTML = `
                <div class="flex justify-start">
                    <div class="message bot">
                        <div class="typing-indicator">
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                </div>`;
            messagesArea.appendChild(indicator);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        /**
         * Hides the "Bot is typing..." indicator.
         */
        function hideTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        /**
         * Enables or disables the input form.
         * @param {boolean} enabled - True to enable, false to disable.
         */
        function toggleInput(enabled) {
            userInput.disabled = !enabled;
            sendButton.disabled = !enabled;
            if (enabled) {
                userInput.focus();
            }
        }

        // --- GEMINI API INTEGRATION ---

        /**
         * Gets a response from the Gemini API.
         * @param {string} userPrompt - The user's latest message.
         * @returns {Promise<string>} The bot's response text.
         */
        async function getBotResponse(userPrompt) {
            // The system prompt instructs the AI on its role and personality.
            const systemPrompt = `You are a helpful, friendly, and professional chatbot assistant for Ryan Guidry. Your goal is to answer questions about him based ONLY on the provided KNOWLEDGE_BASE. Be conversational and concise. Do not make up information. If a question is outside the scope of the knowledge base, politely state that you can only answer questions about Ryan's professional background and skills.`;
            
            // Add the new user message to the history
            chatHistory.push({ role: "user", parts: [{ text: userPrompt }] });

            // Construct the payload for the API
            const payload = {
                contents: [
                    // This is where we give the model its instructions and data
                    {
                        role: "user",
                        parts: [{ text: `${systemPrompt}\n\nKNOWLEDGE_BASE:\n${KNOWLEDGE_BASE}` }]
                    },
                    {
                        role: "model",
                        parts: [{ text: "Understood. I am ready to answer questions about Ryan Guidry based on the provided knowledge." }]
                    },
                    // The rest of the conversation history follows
                    ...chatHistory
                ]
            };
            
            const apiKey = ""; // Leave this empty, it will be handled by the environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`API request failed with status ${response.status}`);
            }

            const result = await response.json();
            
            const botText = result?.candidates?.[0]?.content?.parts?.[0]?.text || "I'm not sure how to respond to that. Could you ask in a different way?";

            // Add the bot's response to our history for context in future turns
            chatHistory.push({ role: "model", parts: [{ text: botText }] });

            return botText;
        }

    </script>
</body>
</html>
